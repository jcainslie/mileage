{% extends 'base.html' %}
{% block content %}

<form method="POST" class="row gy-2 gx-3 align-items-end mb-4">
  <div class="col-auto">
    <label for="month" class="form-label">Month</label>
    <select name="month" id="month" class="form-select" required>
      {% for m in range(1, 13) %}
        <option value="{{ m }}">{{ m }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <label for="year" class="form-label">Year</label>
    <input type="number" name="year" id="year" class="form-control" value="{{ current_year }}" required>
  </div>
  <div class="col-auto">
    <label for="odometer" class="form-label">Odometer</label>
    <input type="number" name="odometer" id="odometer" class="form-control" required>
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-success">âž• Add Mileage</button>
  </div>
</form>



<canvas id="mileageChart" height="100"></canvas>

<table class="table table-striped mt-4">
  <thead class="table-dark">
    <tr>
      <th>Date</th>
      <th>Odometer</th>
      <th>Allowed</th>
      <th>Off Target</th>
    </tr>
  </thead>
  <tbody>
    {% for row in data %}
    <tr class="{% if loop.first %}table-success{% endif %}">
      <td>{{ row.date }}</td>
      <td>{{ row.odometer }}</td>
      <td>{{ row.allowed }}</td>
      <td>{{ row.off_target }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  const labels = {{ chart_data | map(attribute='date') | list | tojson }};
  const odometer = {{ chart_data | map(attribute='odometer') | list | tojson }};
  const allowed = {{ chart_data | map(attribute='allowed') | list | tojson }};

  const ctx = document.getElementById('mileageChart').getContext('2d');
  const mileageChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Actual Odometer',
          data: odometer,
          borderColor: 'blue',
          tension: 0.3,
        },
        {
          label: 'Allowed Mileage',
          data: allowed,
          borderColor: 'green',
          borderDash: [5, 5],
          tension: 0.3,
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>



{% endblock %}
